<!DOCTYPE html>
<html>
<head>
    <title>Set Password</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script>
        window.supabase = supabase.createClient(
            'https://ovqkuwbjstovqjjtrwny.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im92cWt1d2Jqc3RvdnFqanRyd255Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA0OTY5NzUsImV4cCI6MjA1NjA3Mjk3NX0.zEXoXzlyOyE4UvPI7yIzXKOAkjhZv0gYwA35ycwRiPw'
        );

        async function initialize() {
            const urlParams = new URLSearchParams(window.location.search);
            const token = urlParams.get('token');
            
            if (token) {
                // Set the session from the invite token
                const { error } = await supabase.auth.verifyOtp({
                    type: 'invite',
                    token_hash: token
                });

                if (error) {
                    alert('Invalid or expired link');
                    window.location.href = '/employer-login.html';
                }
            }
        }
        
        async function setPassword() {
            const password = document.getElementById('password').value;
            
            // Update password and set role
            const { error } = await supabase.auth.updateUser({
                password: password,
                data: { role: 'employer' }
            });

            if (error) {
                alert('Error: ' + error.message);
            } else {
                alert('Password set successfully! Please login');
                window.location.href = 'employer-login.html';
            }
        }

        // Initialize when page loads
        initialize();
    </script>
</head>
<body>
    <h1>Set Employer Password</h1>
    <input type="password" id="password" placeholder="New password">
    <button onclick="setPassword()">Set Password</button>
</body>
</html>